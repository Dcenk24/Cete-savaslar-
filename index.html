<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gangster Wars - Online Mafya Oyunu</title>
    <meta name="description" content="√úcretsiz online mafya oyunu. √áete kur, d√º≈ümanlarƒ±na saldƒ±r, imparatorluƒüunu b√ºy√ºt!">
    <meta name="keywords" content="mafya oyunu, online oyun, browser game, t√ºrk√ße oyun, gangster wars">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: Arial, sans-serif;
            color: white;
            padding: 10px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .header h1 { font-size: 32px; margin-bottom: 5px; }
        .login-screen {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(0,0,0,0.5);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid rgba(231, 76, 60, 0.5);
        }
        .login-screen h2 { text-align: center; margin-bottom: 30px; font-size: 28px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 14px; }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 6px;
            font-size: 16px;
        }
        .form-group input:focus { outline: none; border-color: #e74c3c; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        .stat-fill {
            height: 100%;
            transition: width 0.3s;
        }
        .energy { background: linear-gradient(90deg, #f39c12, #d68910); }
        .stamina { background: linear-gradient(90deg, #3498db, #2980b9); }
        .health { background: linear-gradient(90deg, #2ecc71, #27ae60); }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            background: rgba(0,0,0,0.4);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .tab:hover { background: rgba(255,255,255,0.1); }
        .tab.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .content {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            min-height: 400px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card:hover {
            background: rgba(255,255,255,0.08);
            cursor: pointer;
        }
        .card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        button {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
        }
        button:hover { background: #229954; }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .btn-red { background: #e74c3c; }
        .btn-red:hover { background: #c0392b; }
        .btn-blue { background: #3498db; }
        .btn-blue:hover { background: #2980b9; }
        .btn-purple { background: #9b59b6; }
        .btn-purple:hover { background: #8e44ad; }
        .notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }
        .notification {
            background: #27ae60;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            animation: slideIn 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .notification.error { background: #e74c3c; }
        .notification.info { background: #3498db; }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .text-small { font-size: 13px; color: #bbb; }
        .text-green { color: #2ecc71; }
        .text-red { color: #e74c3c; }
        .text-blue { color: #3498db; }
        .text-yellow { color: #f39c12; }
        .text-purple { color: #9b59b6; }
        .mt-2 { margin-top: 10px; }
        .mb-2 { margin-bottom: 10px; }
        h2 { margin-bottom: 15px; font-size: 24px; }
        h3 { margin-bottom: 10px; font-size: 18px; }
        .flex { display: flex; justify-content: space-between; align-items: center; }
        .flex-col { display: flex; flex-direction: column; gap: 5px; }
        .leaderboard-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        .rank-1 { border-left-color: #f1c40f; }
        .rank-2 { border-left-color: #bdc3c7; }
        .rank-3 { border-left-color: #cd7f32; }
        .online-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .chat-container {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        .chat-message {
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
        }
        .chat-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 6px;
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-screen">
        <h2>üî´ Gangster Wars</h2>
        <div id="loginForm">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="ornek@email.com">
            </div>
            <div class="form-group">
                <label>≈ûifre</label>
                <input type="password" id="loginPassword" placeholder="******">
            </div>
            <button onclick="auth.login()">Giri≈ü Yap</button>
            <button class="btn-blue" onclick="auth.showRegister()" style="margin-top: 10px;">Kayƒ±t Ol</button>
            <button class="btn-purple" onclick="auth.guestLogin()" style="margin-top: 10px;">Misafir Olarak Gir</button>
        </div>
        <div id="registerForm" class="hidden">
            <div class="form-group">
                <label>Kullanƒ±cƒ± Adƒ±</label>
                <input type="text" id="regUsername" placeholder="Gangster123">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="ornek@email.com">
            </div>
            <div class="form-group">
                <label>≈ûifre</label>
                <input type="password" id="regPassword" placeholder="******">
            </div>
            <button onclick="auth.register()">Kayƒ±t Ol</button>
            <button class="btn-blue" onclick="auth.showLogin()" style="margin-top: 10px;">Giri≈ü Ekranƒ±</button>
        </div>
    </div>

    <div id="gameScreen" class="container hidden">
        <div class="header">
            <div class="flex">
                <div>
                    <h1>üî´ Gangster Wars</h1>
                    <p>Su√ß imparatorluƒüunu kur ve sokaklarƒ±n kralƒ± ol!</p>
                </div>
                <div>
                    <span class="online-indicator"></span>
                    <span id="onlineCount">0</span> online
                    <button class="btn-red" onclick="auth.logout()" style="margin-top: 10px; width: auto; padding: 8px 16px;">√áƒ±kƒ±≈ü</button>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="playerName">Loading...</h3>
                <p class="text-yellow" id="playerLevel">Level 1</p>
                <p class="text-small" id="playerXp">XP: 0/100</p>
                
                <div class="mt-2">
                    <div class="flex"><span>Energy</span><span id="energyText">50/50</span></div>
                    <div class="stat-bar"><div class="stat-fill energy" id="energyBar" style="width: 100%"></div></div>
                </div>
                <div class="mt-2">
                    <div class="flex"><span>Stamina</span><span id="staminaText">20/20</span></div>
                    <div class="stat-bar"><div class="stat-fill stamina" id="staminaBar" style="width: 100%"></div></div>
                </div>
                <div class="mt-2">
                    <div class="flex"><span>Health</span><span id="healthText">100/100</span></div>
                    <div class="stat-bar"><div class="stat-fill health" id="healthBar" style="width: 100%"></div></div>
                </div>
            </div>

            <div class="stat-card">
                <h3>üí∞ Para</h3>
                <div class="mb-2">
                    <p class="text-small">Nakit (riskli)</p>
                    <p class="text-green" style="font-size: 24px;" id="cashAmount">$0</p>
                </div>
                <div>
                    <p class="text-small">Banka (g√ºvenli)</p>
                    <p class="text-blue" style="font-size: 24px;" id="bankAmount">$0</p>
                </div>
            </div>

            <div class="stat-card">
                <h3>‚öîÔ∏è G√º√ß</h3>
                <div class="mb-2">
                    <p class="text-small">Saldƒ±rƒ±</p>
                    <p class="text-red" style="font-size: 24px;" id="attackPower">0</p>
                </div>
                <div class="mb-2">
                    <p class="text-small">Savunma</p>
                    <p class="text-blue" style="font-size: 24px;" id="defensePower">0</p>
                </div>
                <div>
                    <p class="text-small">√áete Boyutu</p>
                    <p class="text-yellow" style="font-size: 24px;" id="gangSize">1</p>
                </div>
                <p class="text-small mt-2">Liderlik Sƒ±ralamasƒ±: <span class="text-purple" id="playerRank">#-</span></p>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="game.switchTab('jobs')">ƒ∞≈üler</button>
            <button class="tab" onclick="game.switchTab('fight')">D√∂v√º≈ü</button>
            <button class="tab" onclick="game.switchTab('shop')">Market</button>
            <button class="tab" onclick="game.switchTab('properties')">M√ºlkler</button>
            <button class="tab" onclick="game.switchTab('leaderboard')">Liderlik</button>
            <button class="tab" onclick="game.switchTab('chat')">Sohbet</button>
            <button class="tab" onclick="game.switchTab('bank')">Banka</button>
        </div>

        <div class="content" id="content">
            <div class="loading">Y√ºkleniyor...</div>
        </div>
    </div>

    <div class="notifications" id="notifications"></div>

    <script>
        // ===========================================
        // FIREBASE CONFIGURATION (PLACEHOLDER)
        // ===========================================
        // √ñNEMLƒ∞: Bu bilgileri Firebase Console'dan alacaksƒ±nƒ±z
        // ≈ûimdilik localStorage ile simulate ediyoruz
        
        const FIREBASE_CONFIG = {
            // Firebase projenizi olu≈üturduktan sonra buraya ekleyeceksiniz:
            // apiKey: "YOUR_API_KEY",
            // authDomain: "YOUR_PROJECT.firebaseapp.com",
            // databaseURL: "https://YOUR_PROJECT.firebaseio.com",
            // projectId: "YOUR_PROJECT",
            // storageBucket: "YOUR_PROJECT.appspot.com",
            // messagingSenderId: "YOUR_SENDER_ID",
            // appId: "YOUR_APP_ID"
        };

        // ===========================================
        // MOCK FIREBASE (Ger√ßek Firebase kurulana kadar)
        // ===========================================
        const mockFirebase = {
            users: JSON.parse(localStorage.getItem('fb_users') || '{}'),
            gameData: JSON.parse(localStorage.getItem('fb_gamedata') || '{}'),
            leaderboard: JSON.parse(localStorage.getItem('fb_leaderboard') || '[]'),
            chat: JSON.parse(localStorage.getItem('fb_chat') || '[]'),
            
            save() {
                localStorage.setItem('fb_users', JSON.stringify(this.users));
                localStorage.setItem('fb_gamedata', JSON.stringify(this.gameData));
                localStorage.setItem('fb_leaderboard', JSON.stringify(this.leaderboard));
                localStorage.setItem('fb_chat', JSON.stringify(this.chat));
            },
            
            auth: {
                currentUser: null,
                
                signInWithEmailAndPassword(email, password) {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            const user = mockFirebase.users[email];
                            if (user && user.password === password) {
                                this.currentUser = { uid: user.uid, email: email };
                                resolve({ user: this.currentUser });
                            } else {
                                reject(new Error('Email veya ≈üifre hatalƒ±'));
                            }
                        }, 500);
                    });
                },
                
                createUserWithEmailAndPassword(email, password) {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (mockFirebase.users[email]) {
                                reject(new Error('Bu email zaten kullanƒ±lƒ±yor'));
                            } else {
                                const uid = 'user_' + Date.now();
                                mockFirebase.users[email] = {
                                    uid: uid,
                                    password: password,
                                    createdAt: Date.now()
                                };
                                this.currentUser = { uid: uid, email: email };
                                mockFirebase.save();
                                resolve({ user: this.currentUser });
                            }
                        }, 500);
                    });
                },
                
                signInAnonymously() {
                    return new Promise((resolve) => {
                        setTimeout(() => {
                            const uid = 'guest_' + Date.now();
                            this.currentUser = { uid: uid, email: null, isAnonymous: true };
                            resolve({ user: this.currentUser });
                        }, 500);
                    });
                },
                
                signOut() {
                    this.currentUser = null;
                    return Promise.resolve();
                }
            },
            
            database: {
                ref(path) {
                    return {
                        set(data) {
                            const keys = path.split('/').filter(k => k);
                            let obj = mockFirebase.gameData;
                            for (let i = 0; i < keys.length - 1; i++) {
                                if (!obj[keys[i]]) obj[keys[i]] = {};
                                obj = obj[keys[i]];
                            }
                            obj[keys[keys.length - 1]] = data;
                            mockFirebase.save();
                            return Promise.resolve();
                        },
                        
                        update(data) {
                            const keys = path.split('/').filter(k => k);
                            let obj = mockFirebase.gameData;
                            for (let i = 0; i < keys.length - 1; i++) {
                                if (!obj[keys[i]]) obj[keys[i]] = {};
                                obj = obj[keys[i]];
                            }
                            obj[keys[keys.length - 1]] = {
                                ...obj[keys[keys.length - 1]],
                                ...data
                            };
                            mockFirebase.save();
                            return Promise.resolve();
                        },
                        
                        once(eventType) {
                            return new Promise((resolve) => {
                                setTimeout(() => {
                                    const keys = path.split('/').filter(k => k);
                                    let obj = mockFirebase.gameData;
                                    for (let key of keys) {
                                        obj = obj?.[key];
                                    }
                                    resolve({
                                        val() { return obj || null; }
                                    });
                                }, 100);
                            });
                        },
                        
                        on(eventType, callback) {
                            // Simplified - would need proper implementation
                            setInterval(() => {
                                const keys = path.split('/').filter(k => k);
                                let obj = mockFirebase.gameData;
                                for (let key of keys) {
                                    obj = obj?.[key];
                                }
                                callback({ val() { return obj || null; } });
                            }, 5000);
                        }
                    };
                }
            }
        };

        // ===========================================
        // AUTHENTICATION SYSTEM
        // ===========================================
        const auth = {
            currentUser: null,
            
            showLogin() {
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
            },
            
            showRegister() {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            },
            
            async login() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    alert('L√ºtfen t√ºm alanlarƒ± doldurun');
                    return;
                }
                
                try {
                    const userCredential = await mockFirebase.auth.signInWithEmailAndPassword(email, password);
                    this.currentUser = userCredential.user;
                    await this.loadGame();
                } catch (error) {
                    alert(error.message);
                }
            },
            
            async register() {
                const username = document.getElementById('regUsername').value;
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                
                if (!username || !email || !password) {
                    alert('L√ºtfen t√ºm alanlarƒ± doldurun');
                    return;
                }
                
                if (password.length < 6) {
                    alert('≈ûifre en az 6 karakter olmalƒ±');
                    return;
                }
                
                try {
                    const userCredential = await mockFirebase.auth.createUserWithEmailAndPassword(email, password);
                    this.currentUser = userCredential.user;
                    
                    // Create initial game data
                    await mockFirebase.database.ref('users/' + this.currentUser.uid).set({
                        username: username,
                        player: {
                            name: username,
                            level: 1,
                            xp: 0,
                            xpToNext: 100,
                            energy: 50,
                            maxEnergy: 50,
                            stamina: 20,
                            maxStamina: 20,
                            health: 100,
                            maxHealth: 100,
                            cash: 1000,
                            bank: 0,
                            gangSize: 1
                        },
                        inventory: [],
                        properties: [],
                        lastIncome: Date.now(),
                        createdAt: Date.now()
                    });
                    
                    await this.loadGame();
                } catch (error) {
                    alert(error.message);
                }
            },
            
            async guestLogin() {
                try {
                    const userCredential = await mockFirebase.auth.signInAnonymously();
                    this.currentUser = userCredential.user;
                    
                    // Create guest game data
                    await mockFirebase.database.ref('users/' + this.currentUser.uid).set({
                        username: 'Misafir_' + Date.now().toString().slice(-4),
                        player: {
                            name: 'Misafir',
                            level: 1,
                            xp: 0,
                            xpToNext: 100,
                            energy: 50,
                            maxEnergy: 50,
                            stamina: 20,
                            maxStamina: 20,
                            health: 100,
                            maxHealth: 100,
                            cash: 1000,
                            bank: 0,
                            gangSize: 1
                        },
                        inventory: [],
                        properties: [],
                        lastIncome: Date.now(),
                        isGuest: true
                    });
                    
                    await this.loadGame();
                } catch (error) {
                    alert(error.message);
                }
            },
            
            async loadGame() {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                
                const snapshot = await mockFirebase.database.ref('users/' + this.currentUser.uid).once('value');
                const userData = snapshot.val();
                
                if (userData) {
                    game.player = userData.player;
                    game.inventory = userData.inventory || [];
                    game.properties = userData.properties || [];
                    game.lastIncome = userData.lastIncome || Date.now();
                    game.username = userData.username;
                    
                    game.init();
                }
            },
            
            async logout() {
                await game.saveToCloud();
                await mockFirebase.auth.signOut();
                this.currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                this.showLogin();
            }
        };

        // ===========================================
        // GAME LOGIC
        // ===========================================
        const game = {
            username: '',
            player: {
                name: "Rookie Gangster",
                level: 1,
                xp: 0,
                xpToNext: 100,
                energy: 50,
                maxEnergy: 50,
                stamina: 20,
                maxStamina: 20,
                health: 100,
                maxHealth: 100,
                cash: 1000,
                bank: 0,
                gangSize: 1
            },
            inventory: [],
            properties: [],
            currentTab: 'jobs',
            lastIncome: Date.now(),
            leaderboard: [],
            chatMessages: [],

            jobs: [
                { id: 1, name: "Yankesicilik", energy: 5, min: 50, max: 100, xp: 10, lvl: 1 },
                { id: 2, name: "Gasp", energy: 8, min: 80, max: 150, xp: 15, lvl: 1 },
                { id: 3, name: "D√ºkkan Soygunu", energy: 12, min: 200, max: 400, xp: 30, lvl: 3 },
                { id: 4, name: "Araba Hƒ±rsƒ±zlƒ±ƒüƒ±", energy: 15, min: 300, max: 600, xp: 45, lvl: 5 },
                { id: 5, name: "Banka Soygunu", energy: 25, min: 800, max: 1500, xp: 100, lvl: 8 },
                { id: 6, name: "Kumarhane Soygunu", energy: 35, min: 2000, max: 4000, xp: 200, lvl: 12 }
            ],

            items: [
                { id: 1, name: "Sokak Serserisi", type: "√únite", atk: 5, def: 5, price: 500, lvl: 1 },
                { id: 2, name: "Kabadayƒ±", type: "√únite", atk: 15, def: 12, price: 2000, lvl: 3 },
                { id: 3, name: "Tetik√ßi", type: "√únite", atk: 30, def: 25, price: 8000, lvl: 7 },
                { id: 4, name: "Mu≈üta", type: "Silah", atk: 8, def: 2, price: 300, lvl: 1 },
                { id: 5, name: "Tabanca", type: "Silah", atk: 20, def: 5, price: 1500, lvl: 4 },
                { id: 6, name: "Pompalƒ±", type: "Silah", atk: 35, def: 8, price: 5000, lvl: 8 },
                { id: 7, name: "Deri Ceket", type: "Zƒ±rh", atk: 2, def: 10, price: 400, lvl: 2 },
                { id: 8, name: "Kur≈üun Ge√ßirmez Yelek", type: "Zƒ±rh", atk: 5, def: 30, price: 3000, lvl: 6 },
                { id: 9, name: "Motor", type: "Ara√ß", atk: 10, def: 8, price: 2500, lvl: 3 },
                { id: 10, name: "Spor Araba", type: "Ara√ß", atk: 25, def: 20, price: 10000, lvl: 9 }
            ],

            propertiesList: [
                { id: 1, name: "Sokak K√∂≈üesi", price: 1000, income: 50, lvl: 1 },
                { id: 2, name: "Rehinli D√ºkkan", price: 5000, income: 200, lvl: 3 },
                { id: 3, name: "Internet Cafe", price: 15000, income: 500, lvl: 6 },
                { id: 4, name: "Bar", price: 40000, income: 1200, lvl: 9 },
                { id: 5, name: "Gece Kul√ºb√º", price: 100000, income: 3000, lvl: 13 }
            ],

            init() {
                this.updateUI();
                this.switchTab('jobs');
                this.loadLeaderboard();
                this.loadChat();
                
                setInterval(() => this.regenerate(), 60000);
                setInterval(() => this.saveToCloud(), 30000);
                setInterval(() => this.loadLeaderboard(), 60000);
                setInterval(() => this.updateOnlineCount(), 10000);
            },

            async saveToCloud() {
                if (!auth.currentUser) return;
                
                try {
                    await mockFirebase.database.ref('users/' + auth.currentUser.uid).update({
                        player: this.player,
                        inventory: this.inventory,
                        properties: this.properties,
                        lastIncome: this.lastIncome,
                        lastOnline: Date.now()
                    });
                    
                    // Update leaderboard
                    const combat = this.calculatePower();
                    const score = this.player.level * 1000 + combat.attack + combat.defense;
                    await mockFirebase.database.ref('leaderboard/' + auth.currentUser.uid).set({
                        username: this.username,
                        level: this.player.level,
                        attack: combat.attack,
                        defense: combat.defense,
                        score: score,
                        updatedAt: Date.now()
                    });
                    
                    mockFirebase.save();
                } catch (error) {
                    console.error('Save error:', error);
                }
            },

            async loadLeaderboard() {
                try {
                    const snapshot = await mockFirebase.database.ref('leaderboard').once('value');
                    const data = snapshot.val() || {};
                    
                    this.leaderboard = Object.entries(data)
                        .map(([uid, user]) => ({ uid, ...user }))
                        .sort((a, b) => b.score - a.score)
                        .slice(0, 100);
                    
                    // Update player rank
                    const myRank = this.leaderboard.findIndex(u => u.uid === auth.currentUser?.uid);
                    if (myRank >= 0) {
                        document.getElementById('playerRank').textContent = '#' + (myRank + 1);
                    }
                } catch (error) {
                    console.error('Leaderboard error:', error);
                }
            },

            async loadChat() {
                try {
                    mockFirebase.database.ref('chat').on('value', (snapshot) => {
                        const messages = snapshot.val() || [];
                        this.chatMessages = Object.values(messages).slice(-50);
                        if (this.currentTab === 'chat') {
                            this.renderChat();
                        }
                    });
                } catch (error) {
                    console.error('Chat error:', error);
                }
            },

            async sendMessage(text) {
                if (!text.trim()) return;
                
                try {
                    const messageId = 'msg_' + Date.now();
                    await mockFirebase.database.ref('chat/' + messageId).set({
                        username: this.username,
                        text: text,
                        timestamp: Date.now()
                    });
                    mockFirebase.save();
                } catch (error) {
                    console.error('Send message error:', error);
                }
            },

            updateOnlineCount() {
                // Simulate online count
                const count = Math.floor(Math.random() * 50) + 10;
                document.getElementById('onlineCount').textContent = count;
            },

            regenerate() {
                const p = this.player;
                p.energy = Math.min(p.maxEnergy, p.energy + 1);
                p.stamina = Math.min(p.maxStamina, p.stamina + 1);
                p.health = Math.min(p.maxHealth, p.health + 1);
                this.updateUI();
                this.saveToCloud();
            },

            updateUI() {
                const p = this.player;
                document.getElementById('playerName').textContent = this.username || p.name;
                document.getElementById('playerLevel').textContent = `Level ${p.level}`;
                document.getElementById('playerXp').textContent = `XP: ${p.xp}/${p.xpToNext}`;
                
                document.getElementById('energyText').textContent = `${p.energy}/${p.maxEnergy}`;
                document.getElementById('energyBar').style.width = `${(p.energy/p.maxEnergy)*100}%`;
                
                document.getElementById('staminaText').textContent = `${p.stamina}/${p.maxStamina}`;
                document.getElementById('staminaBar').style.width = `${(p.stamina/p.maxStamina)*100}%`;
                
                document.getElementById('healthText').textContent = `${p.health}/${p.maxHealth}`;
                document.getElementById('healthBar').style.width = `${(p.health/p.maxHealth)*100}%`;
                
                document.getElementById('cashAmount').textContent = `$${p.cash.toLocaleString()}`;
                document.getElementById('bankAmount').textContent = `$${p.bank.toLocaleString()}`;
                
                const combat = this.calculatePower();
                document.getElementById('attackPower').textContent = combat.attack;
                document.getElementById('defensePower').textContent = combat.defense;
                document.getElementById('gangSize').textContent = p.gangSize;
            },

            calculatePower() {
                let attack = 0, defense = 0;
                const max = Math.min(this.player.gangSize, this.inventory.length);
                
                const sorted = [...this.inventory].sort((a, b) => {
                    const itemA = this.items.find(i => i.id === a.id);
                    const itemB = this.items.find(i => i.id === b.id);
                    return (itemB?.atk || 0) - (itemA?.atk || 0);
                });

                for (let i = 0; i < max; i++) {
                    const item = this.items.find(it => it.id === sorted[i].id);
                    if (item) {
                        attack += item.atk * sorted[i].qty;
                        defense += item.def * sorted[i].qty;
                    }
                }
                
                return { attack, defense };
            },

            notify(msg, type = 'info') {
                const div = document.createElement('div');
                div.className = `notification ${type}`;
                div.textContent = msg;
                document.getElementById('notifications').appendChild(div);
                setTimeout(() => div.remove(), 3000);
            },

            switchTab(tab) {
                this.currentTab = tab;
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');
                
                const content = document.getElementById('content');
                
                if (tab === 'jobs') {
                    this.renderJobs(content);
                } else if (tab === 'fight') {
                    this.renderFight(content);
                } else if (tab === 'shop') {
                    this.renderShop(content);
                } else if (tab === 'properties') {
                    this.renderProperties(content);
                } else if (tab === 'leaderboard') {
                    this.renderLeaderboard(content);
                } else if (tab === 'chat') {
                    this.renderChat(content);
                } else if (tab === 'bank') {
                    this.renderBank(content);
                }
            },

            renderJobs(content) {
                content.innerHTML = '<h2>üíº ƒ∞≈üler</h2><div class="grid" id="jobsGrid"></div>';
                const grid = document.getElementById('jobsGrid');
                this.jobs.forEach(job => {
                    const canDo = this.player.level >= job.lvl && this.player.energy >= job.energy;
                    const card = document.createElement('div');
                    card.className = `card ${!canDo ? 'disabled' : ''}`;
                    if (canDo) card.onclick = () => this.doJob(job.id);
                    card.innerHTML = `
                        <h3>${job.name}</h3>
                        <p class="text-small">‚ö° Energy: ${job.energy}</p>
                        <p class="text-small">üí∞ $${job.min} - $${job.max}</p>
                        <p class="text-small">‚≠ê XP: ${job.xp}</p>
                        <p class="text-small ${this.player.level >= job.lvl ? 'text-green' : 'text-red'}">Level ${job.lvl}</p>
                    `;
                    grid.appendChild(card);
                });
            },

            renderFight(content) {
                content.innerHTML = '<h2>‚öîÔ∏è Ger√ßek Oyunculara Saldƒ±r</h2><p class="text-small mb-2">Online oyuncularla d√∂v√º≈ü!</p><div class="grid" id="fightGrid"></div>';
                const grid = document.getElementById('fightGrid');
                
                // Load other players from leaderboard
                const opponents = this.leaderboard
                    .filter(p => p.uid !== auth.currentUser?.uid)
                    .slice(0, 10);
                
                opponents.forEach(opp => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <h3><span class="online-indicator"></span>${opp.username}</h3>
                        <p class="text-small">Level: ${opp.level}</p>
                        <p class="text-red">‚öîÔ∏è ${opp.attack}</p>
                        <p class="text-blue">üõ°Ô∏è ${opp.defense}</p>
                        <button class="btn-red" onclick="game.attackPlayer('${opp.uid}')" ${this.player.stamina < 5 ? 'disabled' : ''}>
                            Saldƒ±r (5 stamina)
                        </button>
                    `;
                    grid.appendChild(card);
                });
                
                if (opponents.length === 0) {
                    grid.innerHTML = '<p class="text-small">Hen√ºz ba≈üka oyuncu yok. ƒ∞lk oyuncular arasƒ±ndasƒ±nƒ±z!</p>';
                }
            },

            renderShop(content) {
                content.innerHTML = '<h2>üõí Market</h2>';
                if (this.inventory.length > 0) {
                    content.innerHTML += '<h3>Envanteriniz</h3><div class="grid" id="invGrid"></div>';
                    const invGrid = document.getElementById('invGrid');
                    this.inventory.forEach(inv => {
                        const item = this.items.find(i => i.id === inv.id);
                        if (item) {
                            const card = document.createElement('div');
                            card.className = 'card disabled';
                            card.innerHTML = `
                                <h3>${item.name}</h3>
                                <p>Adet: x${inv.qty}</p>
                            `;
                            invGrid.appendChild(card);
                        }
                    });
                }
                content.innerHTML += '<h3 style="margin-top:20px">Satƒ±n Al</h3><div class="grid" id="shopGrid"></div>';
                const grid = document.getElementById('shopGrid');
                this.items.forEach(item => {
                    const canBuy = this.player.level >= item.lvl && this.player.cash >= item.price;
                    const card = document.createElement('div');
                    card.className = `card ${!canBuy ? 'disabled' : ''}`;
                    card.innerHTML = `
                        <h3>${item.name}</h3>
                        <p class="text-small">${item.type}</p>
                        <p class="text-red">‚öîÔ∏è ${item.atk}</p>
                        <p class="text-blue">üõ°Ô∏è ${item.def}</p>
                        <p class="text-green">üí∞ $${item.price.toLocaleString()}</p>
                        <p class="text-small ${this.player.level >= item.lvl ? 'text-green' : 'text-red'}">Level ${item.lvl}</p>
                        <button onclick="game.buyItem(${item.id})" ${!canBuy ? 'disabled' : ''}>Satƒ±n Al</button>
                    `;
                    grid.appendChild(card);
                });
            },

            renderProperties(content) {
                const hourlyIncome = this.properties.reduce((sum, p) => {
                    const prop = this.propertiesList.find(pr => pr.id === p.id);
                    return sum + (prop?.income || 0) * p.qty;
                }, 0);
                
                content.innerHTML = `
                    <h2>üè¢ M√ºlkler</h2>
                    <div class="stat-card" style="margin-bottom:20px">
                        <div class="flex">
                            <div>
                                <p class="text-small">Saatlik Gelir</p>
                                <p class="text-green" style="font-size:28px">$${hourlyIncome.toLocaleString()}/saat</p>
                            </div>
                            <button onclick="game.collectIncome()">Geliri Topla</button>
                        </div>
                    </div>
                `;
                
                if (this.properties.length > 0) {
                    content.innerHTML += '<h3>M√ºlkleriniz</h3><div class="grid" id="ownedProps"></div>';
                    const ownedGrid = document.getElementById('ownedProps');
                    this.properties.forEach(prop => {
                        const p = this.propertiesList.find(pr => pr.id === prop.id);
                        if (p) {
                            const card = document.createElement('div');
                            card.className = 'card disabled';
                            card.innerHTML = `
                                <h3>${p.name}</h3>
                                <p>Adet: x${prop.qty}</p>
                                <p class="text-green">$${p.income}/saat</p>
                            `;
                            ownedGrid.appendChild(card);
                        }
                    });
                }
                
                content.innerHTML += '<h3 style="margin-top:20px">Satƒ±n Al</h3><div class="grid" id="propsGrid"></div>';
                const grid = document.getElementById('propsGrid');
                this.propertiesList.forEach(prop => {
                    const owned = this.properties.filter(p => p.id === prop.id).reduce((s, p) => s + p.qty, 0);
                    const currentPrice = Math.floor(prop.price * Math.pow(1.5, owned));
                    const canBuy = this.player.level >= prop.lvl && this.player.cash >= currentPrice;
                    
                    const card = document.createElement('div');
                    card.className = `card ${!canBuy ? 'disabled' : ''}`;
                    card.innerHTML = `
                        <h3>${prop.name}</h3>
                        <p class="text-green">üíµ $${prop.income}/saat</p>
                        <p class="text-yellow">üí∞ $${currentPrice.toLocaleString()}</p>
                        <p class="text-small">Sahip olunan: ${owned}</p>
                        <p class="text-small ${this.player.level >= prop.lvl ? 'text-green' : 'text-red'}">Level ${prop.lvl}</p>
                        <button onclick="game.buyProperty(${prop.id})" ${!canBuy ? 'disabled' : ''}>Satƒ±n Al</button>
                    `;
                    grid.appendChild(card);
                });
            },

            renderLeaderboard(content) {
                content.innerHTML = '<h2>üèÜ Liderlik Tablosu</h2><p class="text-small mb-2">En g√º√ßl√º gangsterler</p>';
                
                this.leaderboard.slice(0, 50).forEach((user, index) => {
                    const isMe = user.uid === auth.currentUser?.uid;
                    const div = document.createElement('div');
                    div.className = `leaderboard-item rank-${index + 1}`;
                    if (isMe) div.style.background = 'rgba(231, 76, 60, 0.2)';
                    div.innerHTML = `
                        <div class="flex">
                            <div>
                                <strong>${index + 1}. ${user.username}</strong>
                                ${isMe ? '<span class="text-yellow"> (Sƒ∞Z)</span>' : ''}
                                <p class="text-small">Level ${user.level} | ‚öîÔ∏è ${user.attack} | üõ°Ô∏è ${user.defense}</p>
                            </div>
                            <div class="text-yellow" style="font-size: 20px;">${user.score.toLocaleString()}</div>
                        </div>
                    `;
                    content.appendChild(div);
                });
            },

            renderChat(content) {
                if (!content) content = document.getElementById('content');
                content.innerHTML = `
                    <h2>üí¨ Genel Sohbet</h2>
                    <div class="chat-container" id="chatContainer"></div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Mesaj yaz..." maxlength="200">
                        <button onclick="game.sendChatMessage()" style="width: auto; padding: 10px 20px;">G√∂nder</button>
                    </div>
                `;
                
                const container = document.getElementById('chatContainer');
                this.chatMessages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = 'chat-message';
                    const time = new Date(msg.timestamp).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                    div.innerHTML = `
                        <strong class="text-yellow">${msg.username}</strong>
                        <span class="text-small"> ${time}</span><br>
                        ${this.escapeHtml(msg.text)}
                    `;
                    container.appendChild(div);
                });
                
                container.scrollTop = container.scrollHeight;
                
                // Enter key support
                document.getElementById('chatInput').onkeypress = (e) => {
                    if (e.key === 'Enter') this.sendChatMessage();
                };
            },

            renderBank(content) {
                content.innerHTML = `
                    <h2>üè¶ Banka</h2>
                    <div class="stat-card" style="margin-bottom:20px">
                        <h3>Hesap √ñzeti</h3>
                        <div class="flex" style="margin:15px 0">
                            <span>Nakit:</span>
                            <span class="text-green" style="font-size:20px">$${this.player.cash.toLocaleString()}</span>
                        </div>
                        <div class="flex">
                            <span>Banka:</span>
                            <span class="text-blue" style="font-size:20px">$${this.player.bank.toLocaleString()}</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="margin-bottom:20px">
                        <h3>Para Yatƒ±r</h3>
                        <button class="btn-blue" onclick="game.deposit(0.25)" ${this.player.cash < 1 ? 'disabled' : ''}>%25 Yatƒ±r</button>
                        <button class="btn-blue" onclick="game.deposit(0.5)" ${this.player.cash < 1 ? 'disabled' : ''}>%50 Yatƒ±r</button>
                        <button class="btn-blue" onclick="game.deposit(1)" ${this.player.cash < 1 ? 'disabled' : ''}>T√ºm√ºn√º Yatƒ±r</button>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Para √áek</h3>
                        <button onclick="game.withdraw(0.25)" ${this.player.bank < 1 ? 'disabled' : ''}>%25 √áek</button>
                        <button onclick="game.withdraw(0.5)" ${this.player.bank < 1 ? 'disabled' : ''}>%50 √áek</button>
                        <button onclick="game.withdraw(1)" ${this.player.bank < 1 ? 'disabled' : ''}>T√ºm√ºn√º √áek</button>
                    </div>
                `;
            },

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            sendChatMessage() {
                const input = document.getElementById('chatInput');
                const text = input.value.trim();
                if (text) {
                    this.sendMessage(text);
                    input.value = '';
                }
            },

            doJob(jobId) {
                const job = this.jobs.find(j => j.id === jobId);
                const p = this.player;
                
                if (p.energy < job.energy) {
                    this.notify('Yeterli energy yok!', 'error');
                    return;
                }
                
                const earned = Math.floor(Math.random() * (job.max - job.min + 1)) + job.min;
                p.energy -= job.energy;
                p.cash += earned;
                p.xp += job.xp;
                
                if (p.xp >= p.xpToNext) {
                    p.xp -= p.xpToNext;
                    p.level++;
                    p.xpToNext = Math.floor(p.xpToNext * 1.5);
                    p.maxEnergy += 5;
                    p.maxStamina += 2;
                    p.maxHealth += 10;
                    this.notify(`üéâ LEVEL UP! ≈ûimdi level ${p.level}!`, 'info');
                }
                
                this.notify(`${job.name} tamamlandƒ±! $${earned} ve ${job.xp} XP kazandƒ±nƒ±z!`, 'info');
                this.updateUI();
                this.saveToCloud();
                this.renderJobs(document.getElementById('content'));
            },

            async attackPlayer(targetUid) {
                const p = this.player;
                
                if (p.stamina < 5) {
                    this.notify('Yeterli stamina yok!', 'error');
                    return;
                }
                
                // Load target player
                const snapshot = await mockFirebase.database.ref('users/' + targetUid).once('value');
                const targetData = snapshot.val();
                
                if (!targetData) {
                    this.notify('Oyuncu bulunamadƒ±!', 'error');
                    return;
                }
                
                const combat = this.calculatePower();
                const playerPower = combat.attack + Math.random() * 20 - 10;
                
                // Calculate target power
                let targetAttack = 0, targetDefense = 0;
                const targetInventory = targetData.inventory || [];
                const targetGangSize = targetData.player.gangSize || 1;
                const max = Math.min(targetGangSize, targetInventory.length);
                
                for (let i = 0; i < max; i++) {
                    const item = this.items.find(it => it.id === targetInventory[i]?.id);
                    if (item) {
                        targetAttack += item.atk * (targetInventory[i]?.qty || 1);
                        targetDefense += item.def * (targetInventory[i]?.qty || 1);
                    }
                }
                
                const targetPower = targetDefense + Math.random() * 20 - 10;
                const won = playerPower > targetPower;
                
                const stolen = won ? Math.floor((targetData.player.cash || 0) * 0.3) : 0;
                const healthLost = won ? Math.floor(Math.random() * 10) + 5 : Math.floor(Math.random() * 20) + 10;
                
                p.stamina -= 5;
                p.health = Math.max(0, p.health - healthLost);
                
                if (won) {
                    p.cash += stolen;
                    p.xp += 50;
                    this.notify(`‚öîÔ∏è Zafer! ${targetData.username}'i yendiniz ve $${stolen} √ßaldƒ±nƒ±z!`, 'info');
                    
                    // Update target
                    await mockFirebase.database.ref('users/' + targetUid + '/player/cash').set(
                        Math.max(0, (targetData.player.cash || 0) - stolen)
                    );
                } else {
                    const lost = Math.floor(p.cash * 0.1);
                    p.cash = Math.max(0, p.cash - lost);
                    p.xp += 10;
                    this.notify(`üíÄ Maƒülubiyet! ${targetData.username} sizi yendi!`, 'error');
                }
                
                this.updateUI();
                this.saveToCloud();
                this.renderFight(document.getElementById('content'));
            },

            buyItem(itemId) {
                const item = this.items.find(i => i.id === itemId);
                const p = this.player;
                
                if (p.cash < item.price) {
                    this.notify('Yeterli para yok!', 'error');
                    return;
                }
                
                p.cash -= item.price;
                const existing = this.inventory.find(i => i.id === itemId);
                if (existing) {
                    existing.qty++;
                } else {
                    this.inventory.push({ id: itemId, qty: 1 });
                }
                
                this.notify(`${item.name} satƒ±n alƒ±ndƒ±!`, 'info');
                this.updateUI();
                this.saveToCloud();
                this.renderShop(document.getElementById('content'));
            },

            buyProperty(propId) {
                const prop = this.propertiesList.find(p => p.id === propId);
                const owned = this.properties.filter(p => p.id === propId).reduce((s, p) => s + p.qty, 0);
                const price = Math.floor(prop.price * Math.pow(1.5, owned));
                
                if (this.player.cash < price) {
                    this.notify('Yeterli para yok!', 'error');
                    return;
                }
                
                this.player.cash -= price;
                const existing = this.properties.find(p => p.id === propId);
                if (existing) {
                    existing.qty++;
                } else {
                    this.properties.push({ id: propId, qty: 1 });
                }
                
                this.notify(`${prop.name} satƒ±n alƒ±ndƒ±!`, 'info');
                this.updateUI();
                this.saveToCloud();
                this.renderProperties(document.getElementById('content'));
            },

            collectIncome() {
                const now = Date.now();
                const hours = (now - this.lastIncome) / (1000 * 60 * 60);
                let total = 0;
                
                this.properties.forEach(prop => {
                    const p = this.propertiesList.find(pr => pr.id === prop.id);
                    if (p) total += p.income * prop.qty * hours;
                });
                
                total = Math.floor(total);
                if (total > 0) {
                    this.player.cash += total;
                    this.lastIncome = now;
                    this.notify(`$${total} gelir toplandƒ±!`, 'info');
                    this.updateUI();
                    this.saveToCloud();
                } else {
                    this.notify('Hen√ºz toplanacak gelir yok!', 'info');
                }
            },

            deposit(percent) {
                const amount = Math.floor(this.player.cash * percent);
                if (amount < 1) return;
                this.player.cash -= amount;
                this.player.bank += amount;
                this.notify(`$${amount} yatƒ±rƒ±ldƒ±!`, 'info');
                this.updateUI();
                this.saveToCloud();
                this.renderBank(document.getElementById('content'));
            },

            withdraw(percent) {
                const amount = Math.floor(this.player.bank * percent);
                if (amount < 1) return;
                this.player.bank -= amount;
                this.player.cash += amount;
                this.notify(`$${amount} √ßekildi!`, 'info');
                this.updateUI();
                this.saveToCloud();
                this.renderBank(document.getElementById('content'));
            }
        };

        // Auto-start
        window.addEventListener('load', () => {
            game.updateOnlineCount();
        });
    </script>
</body>
</html>